<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jamie Phillips</title>
  <subtitle>Random musings</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.phillipsj.net/"/>
  <updated>2016-12-18T21:42:48.379Z</updated>
  <id>http://www.phillipsj.net/</id>
  
  <author>
    <name>Jamie Phillips</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Announcing Cake.Ftp</title>
    <link href="http://www.phillipsj.net/2016/12/18/Announcing-Cake-Ftp/"/>
    <id>http://www.phillipsj.net/2016/12/18/Announcing-Cake-Ftp/</id>
    <published>2016-12-18T21:41:15.000Z</published>
    <updated>2016-12-18T21:42:48.379Z</updated>
    
    <content type="html"><![CDATA[<p>Just published a new package called <a href="https://www.nuget.org/packages/Cake.Ftp/" target="_blank" rel="external">Cake.Ftp</a>. It is a very basic FTP client that allows you to upload or delete files in your Cake script. Please feel free to open an issue in the <a href="https://github.com/phillipsj/Cake.Ftp" target="_blank" rel="external">repo</a> if there any features you would like to see added.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Just published a new package called &lt;a href=&quot;https://www.nuget.org/packages/Cake.Ftp/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cake.Ftp&lt;/a&gt;. It is
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Cake.AppPackager</title>
    <link href="http://www.phillipsj.net/2016/11/28/Cake-AppPackager/"/>
    <id>http://www.phillipsj.net/2016/11/28/Cake-AppPackager/</id>
    <published>2016-11-29T00:42:21.000Z</published>
    <updated>2016-11-29T00:46:31.125Z</updated>
    
    <content type="html"><![CDATA[<p>Just published a new package called <a href="https://www.nuget.org/packages/Cake.AppPackager/" target="_blank" rel="external">Cake.AppPackager</a>. It integrates <a href="https://goo.gl/2g25OD" target="_blank" rel="external">App Packager</a> into the Cake pipeline so you can now create your Windows app packages using Cake.</p>
<p>Still need to add additional unit tests. Please feel free to open an issue in the <a href="https://github.com/phillipsj/Cake.AppPackager" target="_blank" rel="external">repo</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Just published a new package called &lt;a href=&quot;https://www.nuget.org/packages/Cake.AppPackager/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cake.AppPac
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Extending the Orchard Message Service</title>
    <link href="http://www.phillipsj.net/2016/08/25/Extending-the-Orchard-Message-Service/"/>
    <id>http://www.phillipsj.net/2016/08/25/Extending-the-Orchard-Message-Service/</id>
    <published>2016-08-25T23:22:55.000Z</published>
    <updated>2016-08-26T00:08:20.003Z</updated>
    
    <content type="html"><![CDATA[<p>This journey begin in a somewhat normal way. I needed to allow a user in our Orchard instance to submit a form that would send an email to our ticketing system. I know, no API exists for the ticketing system and I had to use an old school way. After getting the initial implementation, we discovered that the email that was being sent was HTML and that HTML was supported, but a bug fix required emails to be in plain text.  Not only that, but the information that gets parsed has to be the first content in the email. I was hit by a double whammy, my email was HTML and the template that was getting applied to the email was our theme template. So couple different items came out of this.</p>
<ul>
<li>Templates in your theme override templates in your module.</li>
<li>The Message Service uses the EmailMessageChannel.</li>
<li>The EmailMessageChannel uses a specific template.</li>
<li>The EmailMessageChannel detects if the message contains HTML and sets it on the MailMessage.</li>
</ul>
<p>These are good items to know, time to dig into the source code and determine what I needed to do to use my template or send an email as plain text. After a little digging around, I determined that I needed to create two classes, two interfaces, and two templates in my module. The first item I needed to create was an implementation of <em>IMessageChannel</em> for my new type of message channel.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> Orchard.Messaging.Services;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Orchard.MyCustomModule.Services</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IPlainTextMessageChannel</span> : <span class="title">IMessageChannel</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>With that created I need to create a concrete example of the message channel. I just copied the <em>EmailMessageChannel</em> found in the <em>Orchard.Email</em> module. I renamed the class <em>PlainTextMessageChannel</em> and implemented the interface. I then changed the message type to be <em>PlainText</em>, changed the default template to be <em>Template_PlainText_Wrapper</em>. Finally I set the <em>IsBodyHtml</em> to false as I wanted it to be plain text, not HTML.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">namespace Orchard.MyCustomModule.Services &#123;</span><br><span class="line">    public class PlainTextMessageChannel : Component, IPlainTextMessageChannel, IDisposable &#123;</span><br><span class="line">        private readonly SmtpSettingsPart _smtpSettings;</span><br><span class="line">        private readonly IShapeFactory _shapeFactory;</span><br><span class="line">        private readonly IShapeDisplay _shapeDisplay;</span><br><span class="line">        private readonly Lazy&lt;SmtpClient&gt; _smtpClientField;</span><br><span class="line">        public static readonly string MessageType = "PlainText";</span><br><span class="line">    </span><br><span class="line">        public PlainTextMessageChannel(</span><br><span class="line">            IOrchardServices orchardServices,</span><br><span class="line">            IShapeFactory shapeFactory,</span><br><span class="line">            IShapeDisplay shapeDisplay) &#123;</span><br><span class="line">            _shapeFactory = shapeFactory;</span><br><span class="line">            _shapeDisplay = shapeDisplay;</span><br><span class="line">            _smtpSettings = orchardServices.WorkContext.CurrentSite.As&lt;SmtpSettingsPart&gt;();</span><br><span class="line">            _smtpClientField = new Lazy&lt;SmtpClient&gt;(CreateSmtpClient);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        public void Dispose() &#123;</span><br><span class="line">            if (!_smtpClientField.IsValueCreated) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            _smtpClientField.Value.Dispose();</span><br><span class="line">        &#125;</span><br><span class="line">              </span><br><span class="line">        public void Process(IDictionary&lt;string, object&gt; parameters) &#123;</span><br><span class="line">            </span><br><span class="line">            if (!_smtpSettings.IsValid()) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">               </span><br><span class="line">            var emailMessage = new EmailMessage &#123;</span><br><span class="line">                Body = Read(parameters, "Body"),</span><br><span class="line">                Subject = Read(parameters, "Subject"),</span><br><span class="line">                Recipients = Read(parameters, "Recipients"),</span><br><span class="line">                ReplyTo = Read(parameters, "ReplyTo"),</span><br><span class="line">                From = Read(parameters, "From"),</span><br><span class="line">                Bcc = Read(parameters, "Bcc"),</span><br><span class="line">                Cc = Read(parameters, "CC")</span><br><span class="line">            &#125;;</span><br><span class="line">                    </span><br><span class="line">            if (emailMessage.Recipients.Length == 0) &#123;</span><br><span class="line">                Logger.Error("Plain text email message doesn't have any recipient");</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">                 </span><br><span class="line">            // Apply default Body alteration for PlainText Channel.</span><br><span class="line">            var template = _shapeFactory.Create("Template_PlainText_Wrapper", Arguments.From(new &#123;</span><br><span class="line">                Content = new MvcHtmlString(emailMessage.Body)</span><br><span class="line">            &#125;));</span><br><span class="line">    </span><br><span class="line">            var mailMessage = new MailMessage &#123;</span><br><span class="line">                Subject = emailMessage.Subject,</span><br><span class="line">                Body = _shapeDisplay.Display(template),</span><br><span class="line">                IsBodyHtml = false</span><br><span class="line">            &#125;;</span><br><span class="line">    </span><br><span class="line">            if (parameters.ContainsKey("Message")) &#123;</span><br><span class="line">                // A full message object is provided by the sender.</span><br><span class="line">    </span><br><span class="line">                var oldMessage = mailMessage;</span><br><span class="line">                mailMessage = (MailMessage)parameters["Message"];</span><br><span class="line">    </span><br><span class="line">                if (String.IsNullOrWhiteSpace(mailMessage.Subject))</span><br><span class="line">                    mailMessage.Subject = oldMessage.Subject;</span><br><span class="line">    </span><br><span class="line">                if (String.IsNullOrWhiteSpace(mailMessage.Body)) &#123;</span><br><span class="line">                    mailMessage.Body = oldMessage.Body;</span><br><span class="line">                    mailMessage.IsBodyHtml = oldMessage.IsBodyHtml;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            try &#123;</span><br><span class="line">                foreach (var recipient in ParseRecipients(emailMessage.Recipients)) &#123;</span><br><span class="line">                    mailMessage.To.Add(new MailAddress(recipient));</span><br><span class="line">                &#125;</span><br><span class="line">                if (!String.IsNullOrWhiteSpace(emailMessage.Cc)) &#123;</span><br><span class="line">                    foreach (var recipient in ParseRecipients(emailMessage.Cc)) &#123;</span><br><span class="line">                        mailMessage.CC.Add(new MailAddress(recipient));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (!String.IsNullOrWhiteSpace(emailMessage.Bcc)) &#123;</span><br><span class="line">                    foreach (var recipient in ParseRecipients(emailMessage.Bcc)) &#123;</span><br><span class="line">                        mailMessage.Bcc.Add(new MailAddress(recipient));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (!String.IsNullOrWhiteSpace(emailMessage.From)) &#123;</span><br><span class="line">                    mailMessage.From = new MailAddress(emailMessage.From);</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    // Take 'From' address from site settings or web.config.</span><br><span class="line">                    mailMessage.From = !String.IsNullOrWhiteSpace(_smtpSettings.Address)</span><br><span class="line">                        ? new MailAddress(_smtpSettings.Address)</span><br><span class="line">                        : new MailAddress(((SmtpSection)ConfigurationManager.GetSection("system.net/mailSettings/smtp")).From);</span><br><span class="line">                &#125;</span><br><span class="line">                if (!String.IsNullOrWhiteSpace(emailMessage.ReplyTo)) &#123;</span><br><span class="line">                    foreach (var recipient in ParseRecipients(emailMessage.ReplyTo)) &#123;</span><br><span class="line">                        mailMessage.ReplyToList.Add(new MailAddress(recipient));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                _smtpClientField.Value.Send(mailMessage);</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception e) &#123;</span><br><span class="line">                Logger.Error(e, "Could not send plain text email");</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        private SmtpClient CreateSmtpClient() &#123;</span><br><span class="line">            // If no properties are set in the dashboard, use the web.config value.</span><br><span class="line">            if (String.IsNullOrWhiteSpace(_smtpSettings.Host)) &#123;</span><br><span class="line">                return new SmtpClient(); </span><br><span class="line">            &#125;</span><br><span class="line">            var smtpClient = new SmtpClient &#123;</span><br><span class="line">                UseDefaultCredentials = _smtpSettings.RequireCredentials &amp;&amp; _smtpSettings.UseDefaultCredentials</span><br><span class="line">            &#125;;</span><br><span class="line">            if (!smtpClient.UseDefaultCredentials &amp;&amp; !String.IsNullOrWhiteSpace(_smtpSettings.UserName)) &#123;</span><br><span class="line">                smtpClient.Credentials = new NetworkCredential(_smtpSettings.UserName, _smtpSettings.Password);</span><br><span class="line">            &#125;</span><br><span class="line">            if (_smtpSettings.Host != null) &#123;</span><br><span class="line">                smtpClient.Host = _smtpSettings.Host;</span><br><span class="line">            &#125;</span><br><span class="line">            smtpClient.Port = _smtpSettings.Port;</span><br><span class="line">            smtpClient.EnableSsl = _smtpSettings.EnableSsl;</span><br><span class="line">            smtpClient.DeliveryMethod = SmtpDeliveryMethod.Network;</span><br><span class="line">            return smtpClient;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        private string Read(IDictionary&lt;string, object&gt; dictionary, string key) &#123;</span><br><span class="line">            return dictionary.ContainsKey(key) ? dictionary[key] as string : null;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        private IEnumerable&lt;string&gt; ParseRecipients(string recipients) &#123;</span><br><span class="line">            return recipients.Split(new[] &#123;',', ';'&#125;, StringSplitOptions.RemoveEmptyEntries);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now the last piece that needs to be done is implementing the channel selector that gets used by Orchard messaging to know which template to use. Again, I made sure to make the channel name <em>PlainText</em> and the only other item that I needed to changed was the messageType check and the priority level.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">using Orchard;</span><br><span class="line">using Orchard.Messaging.Services;</span><br><span class="line"></span><br><span class="line">namespace Orchard.MyCustomModule.Services &#123;</span><br><span class="line">    public class DefaultPlainTextMessageChannelSelector : Component, IMessageChannelSelector &#123;</span><br><span class="line">        private readonly IWorkContextAccessor _workContextAccessor;</span><br><span class="line">        public const string ChannelName = "PlainText";</span><br><span class="line"></span><br><span class="line">        public DefaultPlainTextMessageChannelSelector(IWorkContextAccessor workContextAccessor) &#123;</span><br><span class="line">            _workContextAccessor = workContextAccessor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public MessageChannelSelectorResult GetChannel(string messageType, object payload) &#123;</span><br><span class="line">            if (messageType == "PlainText") &#123;</span><br><span class="line">                var workContext = _workContextAccessor.GetContext();</span><br><span class="line">                return new MessageChannelSelectorResult &#123;</span><br><span class="line">                    Priority = 49,</span><br><span class="line">                    MessageChannel = () =&gt; workContext.Resolve&lt;IPlainTextMessageChannel&gt;()</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now all that is left is creating the default template that you need in the <em>Views</em> folder to match the name of the template that you set in the <em>PlainTextMessageChannel</em>. To use the new message channel just pass <em>PlainText</em> as the message type and Orchard will wire up everything else.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">_messageService.Send(<span class="string">"PlainText"</span>, parameters);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;This journey begin in a somewhat normal way. I needed to allow a user in our Orchard instance to submit a form that would send an email t
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Orchard" scheme="http://www.phillipsj.net/tags/Orchard/"/>
    
  </entry>
  
  <entry>
    <title>Cake: Unit testing addins</title>
    <link href="http://www.phillipsj.net/2016/08/07/Cake-Unit-testing-addins/"/>
    <id>http://www.phillipsj.net/2016/08/07/Cake-Unit-testing-addins/</id>
    <published>2016-08-07T12:41:18.000Z</published>
    <updated>2016-08-07T12:44:54.444Z</updated>
    
    <content type="html"><![CDATA[<p>I am back with another confession to make, my <a href="">Cake.XdtTransform</a> project does not have any unit testing. So I decided this is a great opportunity to create a tutorial for unit testing a Cake addin.</p>
<h2 id="Step-1-Create-unit-test-project"><a href="#Step-1-Create-unit-test-project" class="headerlink" title="Step 1: Create unit test project"></a>Step 1: Create unit test project</h2><p>Create a new <em>class library</em> project named <em>Cake.XdtTransform.Tests</em>, as part of our Cake.XdtTransform solution, and delete the Class1.cs file that is automatically created. The first item you will need is the <em>Cake.Testing</em> Nuget package, so please install that into your <em>Cake.XdtTransform.Tests</em> project. <em>Cake.Testing</em> provides a nice set of fakes, fixtures, and extensions that can help with unit testing. At this point, you can pick your favorite unit testing frameworky, in this example we will create our unit tests using <em>Fixie</em> and <em>Should</em> for assertions, the Cake project uses <em>Xunit2</em>. There are lots of examples in the source code. Start by creating a class called <em>XdtTransformationTests.cs</em>. </p>
<h2 id="Step-2-Code"><a href="#Step-2-Code" class="headerlink" title="Step 2: Code"></a>Step 2: Code</h2><p>Lets start writing our unit tests. We are going to follow a few other conventions from the Cake source code as I find it helpful. In your <em>XdtTransformationTests.cs</em> class. Letâ€™s create the initial class and the basic items needed.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationTests</span> &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>As you see we have created a class for the tests which is all that is really needed with Fixie. Before we can start testing we will create a fixture for our <em>XdtTransform</em> class. This is another convention that is prevalent throughout the Cake source code that I find useful. So create a folder in our <em>Cake.XdtTransform.Tests</em> project called <em>Fixtures</em>, and then create a class in that folder called <em>XdtTransformationFixture.cs</em>. Here is the basic structure of that class.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests.Fixtures</span> &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationFixture</span> &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">XdtTransformationFixture</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now that we have the basic structure of the fixture we are going to go through several steps to get it setup for using in our tests. In Cake, these fixtures wrap the class you are testing and performs all the necessary setup. This is also the class that will use several of the fakes that are included in the <em>Cake.Testing</em> Nuget package. So lets start off by create our constructor.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests.Fixtures</span> &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationFixture</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">XdtTransformationFixture</span>(<span class="params"><span class="keyword">bool</span> sourceFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> transformFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> targetFileExists = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>In this constructor we are going to be passing booleans to toggle if a file is needed. This way we can easily write unit tests that validate that we passed a valid file to our methods. Inside the constructor we need to setup the cake environment, the file system, and make sure our source and transform files exist.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"><span class="keyword">using</span> Cake.Testing;</span><br><span class="line"><span class="keyword">using</span> Cake.XdtTransform.Tests.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests.Fixtures</span> &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationFixture</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> IFileSystem FileSystem &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath SourceFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath TransformFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath TargetFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">XdtTransformationFixture</span>(<span class="params"><span class="keyword">bool</span> sourceFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> transformFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> targetFileExists = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> environment = FakeEnvironment.CreateUnixEnvironment();</span><br><span class="line">            <span class="keyword">var</span> fileSystem = <span class="keyword">new</span> FakeFileSystem(environment);</span><br><span class="line">            fileSystem.CreateDirectory(<span class="string">"/Working"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sourceFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> sourceFile = fileSystem.CreateFile(<span class="string">"/Working/web.config"</span>).SetContent(Resources.XdtTransformation_SourceFile);</span><br><span class="line">                SourceFile = sourceFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (transformFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> transformFile = fileSystem.CreateFile(<span class="string">"/Working/web.release.config"</span>).SetContent(Resources.XdtTramsformation_TransformFile);</span><br><span class="line">                TransformFile = transformFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (targetFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> targetFile = fileSystem.CreateFile(<span class="string">"/Working/transformed.config"</span>).SetContent(Resources.XdtTransformation_TargetFile);</span><br><span class="line">                TargetFile = targetFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                TargetFile = <span class="string">"/Working/transformed.config"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            FileSystem = fileSystem;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So lets walk through the code that is above. The first thing we do is use the <em>FakeEnvrionment</em> to create a <em>CakeEnvironment</em> for unix. Then we use that environment to create a <em>FakeFileSystem</em>. We then create a directory in our fake file system. After that we just make sure that we create any necessary files that we need to exist in that fake directory. You will also notice that we are using a few resources. Those files are real contents of the files that are represented just stored as resources in the project.</p>
<p>Now lets implement the method we will be testing using our fixture, the TransformConfig method. This method just wraps the XdtTransformation.TransformConfig method, but provides all the necessary environment configuration for it.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"><span class="keyword">using</span> Cake.Testing;</span><br><span class="line"><span class="keyword">using</span> Cake.XdtTransform.Tests.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests.Fixtures</span> &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationFixture</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> IFileSystem FileSystem &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath SourceFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath TransformFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> FilePath TargetFile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">XdtTransformationFixture</span>(<span class="params"><span class="keyword">bool</span> sourceFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> transformFileExists = <span class="literal">true</span>, <span class="keyword">bool</span> targetFileExists = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> environment = FakeEnvironment.CreateUnixEnvironment();</span><br><span class="line">            <span class="keyword">var</span> fileSystem = <span class="keyword">new</span> FakeFileSystem(environment);</span><br><span class="line">            fileSystem.CreateDirectory(<span class="string">"/Working"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sourceFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> sourceFile = fileSystem.CreateFile(<span class="string">"/Working/web.config"</span>).SetContent(Resources.XdtTransformation_SourceFile);</span><br><span class="line">                SourceFile = sourceFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (transformFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> transformFile = fileSystem.CreateFile(<span class="string">"/Working/web.release.config"</span>).SetContent(Resources.XdtTramsformation_TransformFile);</span><br><span class="line">                TransformFile = transformFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (targetFileExists) &#123;</span><br><span class="line">                <span class="keyword">var</span> targetFile = fileSystem.CreateFile(<span class="string">"/Working/transformed.config"</span>).SetContent(Resources.XdtTransformation_TargetFile);</span><br><span class="line">                TargetFile = targetFile.Path;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                TargetFile = <span class="string">"/Working/transformed.config"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            FileSystem = fileSystem;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TransformConfig</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            XdtTransformation.TransformConfig(FileSystem, SourceFile, TransformFile, TargetFile);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now we can get back to writing our unit tests. In our XdtTransformationTests class we need to test that we generate the correct errors when passing invalid data and we need to make sure that the XDT transformation correctly works. Lets go ahead and stub out all of these methods.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"><span class="keyword">using</span> Cake.XdtTransform.Tests.Fixtures;</span><br><span class="line"><span class="keyword">using</span> Should;</span><br><span class="line"><span class="keyword">using</span> Should.Core.Assertions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.XdtTransform.Tests</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">XdtTransformationTests</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfSourceFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTransformFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTargetFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfSourceFileNotExists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTransformFileNotExists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldTransformFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Checking-for-null-arguments"><a href="#Checking-for-null-arguments" class="headerlink" title="Checking for null arguments"></a>Checking for null arguments</h3><p>With these method stubbed out, I am going to use a short hand in all the code examples with just the method name. The first three methods are going to look very similar.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfSourceFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;SourceFile = <span class="literal">null</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;ArgumentNullException&gt;().ParamName.ShouldEqual(<span class="string">"sourceFile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So we configure our fixture and set it up so the source file is null. We then record the result and assert our expectation. In this case we expect that the <em>sourceFile</em> parameter will throw an ArgumentNullException.</p>
<p>The next few tests look almost identical.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTransformFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;TransformFile = <span class="literal">null</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;ArgumentNullException&gt;().ParamName.ShouldEqual(<span class="string">"transformFile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTargetFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;TargetFile = <span class="literal">null</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;ArgumentNullException&gt;().ParamName.ShouldEqual(<span class="string">"targetFile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Checking-if-file-exists"><a href="#Checking-if-file-exists" class="headerlink" title="Checking if file exists"></a>Checking if file exists</h3><p>We are now going to unit test if the file exist and if it doesnâ€™t, make sure we are throwing our FileNotFoundException.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfSourceFileNotExists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture(sourceFileExists: <span class="literal">false</span>) &#123;</span><br><span class="line">        SourceFile = <span class="string">"/Working/non-existing.config"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;FileNotFoundException&gt;().Message.ShouldContain(<span class="string">"Unable to find the specified file."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfTransformFileNotExists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture(transformFileExists: <span class="literal">false</span>) &#123;</span><br><span class="line">        TransformFile = <span class="string">"/Working/non-existing-transform.config"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;FileNotFoundException&gt;().Message.ShouldContain(<span class="string">"Unable to find the specified file."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This doesnâ€™t look too different, other than the initial setup of the fixture. We are telling the fixture that the file does not need to exist and we are creating an invalid file path. Finally we record and assert the exception occurs.</p>
<h3 id="Checking-the-transform-method"><a href="#Checking-the-transform-method" class="headerlink" title="Checking the transform method"></a>Checking the transform method</h3><p>We are finally ready to test the method.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldTransformFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;</span><br><span class="line">        TargetFile = <span class="string">"/Working/transformed.config"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    fixture.TransformConfig();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    <span class="keyword">var</span> transformedFile = fixture.FileSystem.GetFile(fixture.TargetFile);</span><br><span class="line">    transformedFile.Exists.ShouldEqual(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">string</span> transformedString;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> transformedStream = transformedFile.OpenRead()) &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> streamReader = <span class="keyword">new</span> StreamReader(transformedStream, Encoding.UTF8)) &#123;</span><br><span class="line">            transformedString = streamReader.ReadToEnd();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    transformedString.ShouldContain(<span class="string">"&lt;add key=\"transformed\" value=\"false\"/&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>We configure the fixture with the name of our target file. We run the transfom and then we grab the generated file from the fake file system, make sure it exists, then we see if it contains the transformed setting.</p>
<h1 id="The-finish-line"><a href="#The-finish-line" class="headerlink" title="The finish line"></a>The finish line</h1><p>Now that we have unit tests, they are not of much use if we donâ€™t run them. So please refer to my previous <a href="http://www.phillipsj.net/2016/07/24/Cake-Automating-an-existing-project/">post</a> about automating an existing project. Go to step 5 to see how to add Fixie and the task your your Cake file.</p>
<p>Thanks for reading. </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I am back with another confession to make, my &lt;a href=&quot;&quot;&gt;Cake.XdtTransform&lt;/a&gt; project does not have any unit testing. So I decided this 
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
      <category term="Tutorials" scheme="http://www.phillipsj.net/tags/Tutorials/"/>
    
  </entry>
  
  <entry>
    <title>Cake: Creating your first addin</title>
    <link href="http://www.phillipsj.net/2016/07/31/Cake-Creating-your-first-addin/"/>
    <id>http://www.phillipsj.net/2016/07/31/Cake-Creating-your-first-addin/</id>
    <published>2016-07-31T19:22:46.000Z</published>
    <updated>2016-08-07T11:11:25.356Z</updated>
    
    <content type="html"><![CDATA[<p>In this tutorial, I will be walking you through the basics of creating a Cake Addin. There are going to be assumptions that you know how to create a project using Visual Studio or your tool of choice. It also assumes you know how to use NuGet to install packages in your project.  Letâ€™s get started, we are going to create a really simple addin that gives you the ability to upload a file to an FTP site.</p>
<h2 id="Step-1-Setup"><a href="#Step-1-Setup" class="headerlink" title="Step 1: Setup"></a>Step 1: Setup</h2><p>Create a new <em>class library</em> project in Visual Studio named <em>Cake.Ftp</em> and delete the Class1.cs file that is automatically created. Your library doesnâ€™t have to follow this naming convention, but this is the community standard that is the most prevalent. The first item you will need is the <em>Cake.Core</em> Nuget package, so please install that into your <em>Cake.Ftp</em> project. Now that is handled you are going to need to create two files. One of those files will be the primary file that holds your logic and the other file will be your Cake aliases.</p>
<h3 id="An-important-note"><a href="#An-important-note" class="headerlink" title="An important note:"></a>An important note:</h3><p>Cake aliases are convenience methods that make your functionality available from your Cake file. Without the alias, the convenience of just calling your method in the Cake file will not be there and you will have to perform other steps. So remember to always create aliases for your addins. To read more about aliases see the documentation <a href="http://cakebuild.net/docs/fundamentals/aliases" target="_blank" rel="external">here</a>.</p>
<p>The first file that needs created is <em>FtpClient.cs</em>, this will house the primary logic of our FTP addin. After that file has been created go ahead and create the <em>FtpAliases.cs</em> class which will house our aliases.</p>
<h2 id="Step-2-Code"><a href="#Step-2-Code" class="headerlink" title="Step 2: Code"></a>Step 2: Code</h2><p>Now lets start building our our <em>FtpClient</em>. We are just going to have the basic functionality of uploading a file to an FTP server to start.  So lets create our constructor.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.Ftp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FtpClient</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FtpClient</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>That looks pretty standard and doesnâ€™t appear to be anything new that you wouldnâ€™t expect. To upload a file we are going to need access to the file system, we need to know about the Cake environment, and I would like to perform some logging. Luckily, Cake provides some interfaces for use that provide us with access to these environments. Additionally, this will allow for unit testing if we so choose. Cake uses one of my favorite dependency injection frameworks, <a href="https://autofac.org/" target="_blank" rel="external">Autofac</a> for dependency injection, so all you need to do is put these in your constructor and Cake handles the rest.  </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Cake.Core;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.Ftp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FtpClient</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IFileSystem _fileSystem;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ICakeEnvironment _environment;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ICakeLog _log;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> StringComparison _comparison;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FtpClient</span>(<span class="params">IFileSystem fileSystem, ICakeEnvironment environment, ICakeLog log</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (fileSystem == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(fileSystem));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (environment == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(environment));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (log == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(log));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _fileSystem = fileSystem;</span><br><span class="line">            _environment = environment;</span><br><span class="line">            _log = log;</span><br><span class="line">            _comparison = environment.Platform.IsUnix() ? StringComparison.Ordinal : StringComparison.OrdinalIgnoreCase;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Of course as you see above it is a good practice that if any of these items that you need to create your class are not available to throw an error. You may have noticed by now that we have a <em>StringComparison</em> class being created in the constructor, the purpose of this is to make sure we compare strings correctly regardless of operating system.</p>
<p>Now with all the basic stuff out of the way lets start creating our file upload method. We are going to create our initial definition for our method. We need the FTP location, the file that we need to upload, the username, and the password we want to use. Then we are going to make sure that none of our required parameters are null, finally we check to make sure that we are actually passed an FTP URI.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UploadFile</span>(<span class="params">Uri serverUri, FilePath fileToUpload, <span class="keyword">string</span> username, <span class="keyword">string</span> password</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (serverUri == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(serverUri), <span class="string">"Server URI is null."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fileToUpload == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(fileToUpload), <span class="string">"File to upload is null."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrWhiteSpace(username)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(username), <span class="string">"Username is null."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrWhiteSpace(password)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(password), <span class="string">"Password is null."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (serverUri.Scheme != Uri.UriSchemeFtp) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="string">"Server URI scheme is not FTP."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>With all the plumbing out of the way, we are going to create our FTP Request, create our credentials, grab our file, and upload it. While we are doing that we are going to add some verbose logging and some informational logging to help debug if there are any issues. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Cake.Core;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constructor and namespace.</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UploadFile</span>(<span class="params">Uri serverUri, FilePath fileToUpload, <span class="keyword">string</span> username, <span class="keyword">string</span> password</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (serverUri == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(serverUri), <span class="string">"Server URI is null."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (fileToUpload == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(fileToUpload), <span class="string">"File to upload is null."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrWhiteSpace(username)) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(username), <span class="string">"Username is null."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrWhiteSpace(password)) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(password), <span class="string">"Password is null."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (serverUri.Scheme != Uri.UriSchemeFtp) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="string">"Server URI scheme is not FTP."</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Adding verbose logging for the URI being used.</span></span><br><span class="line">     _log.Verbose(<span class="string">"Uploading file to &#123;0&#125;"</span>, serverUri);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Creating the request</span></span><br><span class="line">     <span class="keyword">var</span> request = (FtpWebRequest) WebRequest.Create(serverUri);</span><br><span class="line">     request.Method = WebRequestMethods.Ftp.UploadFile;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Adding verbose logging for credentials used.</span></span><br><span class="line">     _log.Verbose(<span class="string">"Using the following credentials &#123;0&#125;, &#123;1&#125;"</span>, username, password);</span><br><span class="line">     request.Credentials = <span class="keyword">new</span> NetworkCredential(username, password);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Using the abstracted filesystem to get the file.</span></span><br><span class="line">     <span class="keyword">var</span> uploadFile = _fileSystem.GetFile(fileToUpload);</span><br><span class="line">           </span><br><span class="line">     <span class="keyword">using</span> (<span class="keyword">var</span> streamReader = <span class="keyword">new</span> StreamReader(uploadFile.OpenRead()))&#123;</span><br><span class="line">         <span class="comment">// Get the file contents.</span></span><br><span class="line">         <span class="keyword">var</span> fileContents = Encoding.UTF8.GetBytes(streamReader.ReadToEnd());</span><br><span class="line">         request.ContentLength = fileContents.Length;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Writing the file to the request stream.</span></span><br><span class="line">         <span class="keyword">var</span> requestStream = request.GetRequestStream();</span><br><span class="line">         requestStream.Write(fileContents, <span class="number">0</span>, fileContents.Length);</span><br><span class="line">         requestStream.Close();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Getting the response from the FTP server.</span></span><br><span class="line">         <span class="keyword">var</span> response = (FtpWebResponse) request.GetResponse();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Logging if it completed and the description of the status returned.</span></span><br><span class="line">         _log.Information(<span class="string">"File upload complete, status &#123;0&#125;"</span>, response.StatusDescription);</span><br><span class="line">         response.Close();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Step-3-Cake-Aliases"><a href="#Step-3-Cake-Aliases" class="headerlink" title="Step 3: Cake Aliases"></a>Step 3: Cake Aliases</h2><p>Now the only piece that is left is to create your Cake aliases. If your <em>FtpAliases</em> file, create the following, static method. The only parameter that you donâ€™t use in your <em>FtpClient</em> is the ICakeContext and if you notice this just basically an extension method to the Cake context. Make sure to annotate the extension method with the <em>CakeMethodAlias</em> attribute so it is make visible in the cake file. I like to add <em>CakeAliasCategory</em> attributes, but it isnâ€™t necessary.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Cake.Core;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.Annotations;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.Ftp</span> &#123;</span><br><span class="line">    [CakeAliasCategory(<span class="string">"FTP"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FtpAliases</span> &#123;</span><br><span class="line">        [CakeMethodAlias]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FtpUploadFile</span>(<span class="params"><span class="keyword">this</span> ICakeContext context, Uri serverUri, FilePath fileToUpload, </span><br><span class="line">            <span class="keyword">string</span> username, <span class="keyword">string</span> password</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (context == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(context));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> ftpClient = <span class="keyword">new</span> FtpClient(context.FileSystem, context.Environment, context.Log);</span><br><span class="line">            ftpClient.UploadFile(serverUri, fileToUpload, username, password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>At this point, you would be finished creating your first addin, however, a nice touch would be to document your method using XML comments amd provide a code example, another Cake project and community standard. With these added, if your addin is added to the Cake website, the documentation on the site will automagically be available.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Cake.Core;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.Annotations;</span><br><span class="line"><span class="keyword">using</span> Cake.Core.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cake.Ftp</span> &#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Contains functionality for working with FTP</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [CakeAliasCategory(<span class="string">"FTP"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FtpAliases</span> &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Uploads the file to the FTP server using the supplied credentials.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;example&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;code&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Task("UploadFile")</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>   .Does(() =&gt; &#123;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>     var fileToUpload = File("some.txt");</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>     FtpUploadFile("ftp://myserver/random/test.htm", fileToUpload, "some-user", "some-password");</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> &#125;);</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/code&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/example&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="context"&gt;</span>The context.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="serverUri"&gt;</span>FTP URI requring FTP:// scehma.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="fileToUpload"&gt;</span>The file to be uploaded.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="username"&gt;</span>Username of the FTP account.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="password"&gt;</span>Password of the FTP account.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        [CakeMethodAlias]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FtpUploadFile</span>(<span class="params"><span class="keyword">this</span> ICakeContext context, Uri serverUri, FilePath fileToUpload, </span><br><span class="line">            <span class="keyword">string</span> username, <span class="keyword">string</span> password</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (context == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(context));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> ftpClient = <span class="keyword">new</span> FtpClient(context.FileSystem, context.Environment, context.Log);</span><br><span class="line">            ftpClient.UploadFile(serverUri, fileToUpload, username, password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="The-finish-line"><a href="#The-finish-line" class="headerlink" title="The finish line"></a>The finish line</h1><p>There you go, a basic tutorial on creating a Cake addin. I hope to publish a follow up tutorial shortly on how to perform unit testing of a Cake addin. If you are finding these useful or have any suggestions or ideas on what I should do next, please let me know on Twitter <a href="https://twitter.com/phillipsj73" target="_blank" rel="external">@phillipsj73</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;In this tutorial, I will be walking you through the basics of creating a Cake Addin. There are going to be assumptions that you know how 
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
      <category term="Tutorials" scheme="http://www.phillipsj.net/tags/Tutorials/"/>
    
  </entry>
  
  <entry>
    <title>Using C# 6 features in Cake</title>
    <link href="http://www.phillipsj.net/2016/07/25/Using-C-6-features-in-Cake/"/>
    <id>http://www.phillipsj.net/2016/07/25/Using-C-6-features-in-Cake/</id>
    <published>2016-07-26T01:47:22.000Z</published>
    <updated>2016-07-27T10:30:15.092Z</updated>
    
    <content type="html"><![CDATA[<p>I like a lot of features available in C# 6, but my favorite is string interpolation. I think it makes aesthetically pleasing code, cleaner and more expressive.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Dave"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// String.Format example</span></span><br><span class="line"><span class="keyword">var</span> messageWithFormat = <span class="keyword">string</span>.Format(<span class="string">"I'm sorry, &#123;0&#125; I'm afraid I can't do that."</span>, name);</span><br><span class="line"></span><br><span class="line"><span class="comment">// String Interpolation</span></span><br><span class="line"><span class="keyword">var</span> messageWithInterpolation = <span class="string">$"I'm sorry, <span class="subst">&#123;name&#125;</span> I'm afraid I can't do that."</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>However, by default you cannot use string interpolation in your Cake file as those bits donâ€™t come with Roslyn just yet. This is an extremely easy fix. All you need to do is pass the experimental flag.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .\build.ps1 -experimental</span><br></pre></td></tr></table></figure>
<p>This just gets old and repetitive and I donâ€™t know about you, but I like staying as close to the leading edge as possible, so I just make a small change to my bootstrapper file to always pass the experimental flag. Roughly on like 188 of your bootstrapper file, just replace the <em>$UseExperimental</em> variable with the <em>-experimental</em> flag. </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Previous </span></span><br><span class="line"><span class="built_in">Invoke-Expression</span> <span class="string">"&amp; `"<span class="variable">$CAKE_EXE</span>`" `"<span class="variable">$Script</span>`" -target=`"<span class="variable">$Target</span>`" -configuration=`"<span class="variable">$Configuration</span>`" -verbosity=`"<span class="variable">$Verbosity</span>`" <span class="variable">$UseMono</span> <span class="variable">$UseDryRun</span> <span class="variable">$UseExperimental</span> <span class="variable">$ScriptArgs</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Altered</span></span><br><span class="line"><span class="built_in">Invoke-Expression</span> <span class="string">"&amp; `"<span class="variable">$CAKE_EXE</span>`" `"<span class="variable">$Script</span>`" -target=`"<span class="variable">$Target</span>`" -configuration=`"<span class="variable">$Configuration</span>`" -verbosity=`"<span class="variable">$Verbosity</span>`" <span class="variable">$UseMono</span> <span class="variable">$UseDryRun</span> -experimental <span class="variable">$ScriptArgs</span>"</span></span><br></pre></td></tr></table></figure>
<p>Now you can make your Cake even more elegant, in my opinion. Here are a few examples of places that string interpolation can be used that I enjoy.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Before</span></span><br><span class="line">Fixie(<span class="string">"./src/\**/bin/"</span> + configuration + <span class="string">"/*.Tests.dll"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line">Fixie(<span class="string">$"./src/\**/bin/<span class="subst">&#123;configuration&#125;</span>/*.Tests.dll"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Before</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> DirectoryNotFoundException(</span><br><span class="line">        <span class="keyword">string</span>.Format(</span><br><span class="line">            <span class="string">"Deployment target directory not found &#123;0&#125;"</span>,</span><br><span class="line">            deploymentPath</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">// After</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> DirectoryNotFoundException(</span><br><span class="line">            <span class="string">$"Deployment target directory not found <span class="subst">&#123;deploymentPath&#125;</span>"</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Thanks for reading.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I like a lot of features available in C# 6, but my favorite is string interpolation. I think it makes aesthetically pleasing code, cleane
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Cake: Automating an existing project</title>
    <link href="http://www.phillipsj.net/2016/07/24/Cake-Automating-an-existing-project/"/>
    <id>http://www.phillipsj.net/2016/07/24/Cake-Automating-an-existing-project/</id>
    <published>2016-07-24T19:22:36.000Z</published>
    <updated>2016-08-07T12:40:08.752Z</updated>
    
    <content type="html"><![CDATA[<p>Hi, my name is Jamie and I am a <a href="http://cakebuild.net/" target="_blank" rel="external">Cake</a> addin author that doesnâ€™t build my addins using Cake. This seems kind of wrong too me and this is a bonus for you. I am going to walk you through how to use Cake to build your project, run your tests, create a <a href="https://www.nuget.org/" target="_blank" rel="external">NuGet</a> package, then publish to NuGet. I am going to walk you through performing this for my <a href="https://github.com/phillipsj/Cake.XdtTransform" target="_blank" rel="external">Cake.XdtTransform</a> project. The project is hosted on GitHub so you can see the final build. I am going to be using the wonderful extension created for <a href="https://code.visualstudio.com/" target="_blank" rel="external">VsCode</a> and will be doing most of my work in it, I will discuss the alternatives if you are not using VsCode. If you are going to continue with VsCode, then I would install the Cake Extension that has been created.</p>
<p>** Steps 1-2 can be skipped if you go grab those files from the <a href="https://github.com/cake-build/example" target="_blank" rel="external">example</a> project.</p>
<h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1:"></a>Step 1:</h2><p>By default all projects that use Cake starts with two files, the bootstrapper script, <em>build.ps1</em>, if on windows, or <em>build.sh</em>, on linux. The other file that is needed is the cake file, typically called <em>build.cake</em>.  In VsCode, open the project that you want to automate with Cake, open the command palette and run the Cake: Install Bootstrapper command, the select the bootstrapper file type that fits your system, in this example I have selected <em>Powershell</em>.  You should now see the <em>build.ps1</em> file in your project directory. At this point, there is not much more you are going to need to do with the bootstrapper file.</p>
<p><img src="/images/cake-tutorial/VsCodeCakeBootstrapper.png" alt=""></p>
<p><img src="/images/cake-tutorial/VsCodeCakeSelectBootstrapperType.png" alt=""></p>
<p><img src="/images/cake-tutorial/VsCodeCakeSelectBootstrapperInstalled.png" alt=""></p>
<h2 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2:"></a>Step 2:</h2><p>Now you need to create your <em>build.cake</em> file. Once you have created the file we need to start putting in the basic plumbing that will be required. What is going to be shown below is typically the norm for most cake files, however, it isnâ€™t the only way it can be done. </p>
<h3 id="Setting-up-arguments"><a href="#Setting-up-arguments" class="headerlink" title="Setting up arguments"></a>Setting up arguments</h3><p>Now you need to grab any arguments you want to pass to your cake file. The first argument we are going to grab that is passed in is the <em>target</em> argument. This will be the task that you want Cake to execute when it runs. It is set to <em>Default</em> if nothing is passed in. The second argument is the <em>configuration</em> that you want to target, it is set to â€œ<em>Release</em> if nothing is passed. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> target = Argument(<span class="string">"target"</span>, <span class="string">"Default"</span>);</span><br><span class="line"><span class="keyword">var</span> configuration = Argument(<span class="string">"configuration"</span>, <span class="string">"Release"</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><em>* A special note about arguments. If you open the bootstrapper file you will see that the arguments are parsed out by powershell then passed to your </em>build.cake* file. If you need to extend the arguments you will need to modify the bootstrapper file.</p>
<h3 id="Letâ€™s-run-Cake"><a href="#Letâ€™s-run-Cake" class="headerlink" title="Letâ€™s run Cake"></a>Letâ€™s run Cake</h3><p>At this point, lets open a powershell window and run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .\build.ps1</span><br></pre></td></tr></table></figure>
<p>You should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Preparing to run build script...</span><br><span class="line">Running build script...</span><br><span class="line">Analyzing build script...</span><br><span class="line">Processing build script...</span><br><span class="line">Downloading and installing Roslyn...</span><br><span class="line">Installing packages (using https://packages.nuget.org/api/v2)...</span><br><span class="line">Copying files...</span><br><span class="line">Copying Roslyn.Compilers.CSharp.dll...</span><br><span class="line">Copying Roslyn.Compilers.dll...</span><br><span class="line">Deleting installation directory...</span><br><span class="line">Compiling build script...</span><br></pre></td></tr></table></figure>
<p>You will also notice that a tools folder has been added to your project with a Cake folder, nuget.exe, and a packages.config.  This the bootstrapper getting nuget and configuring it, and then install Cake. This is pretty awesome as it doesnâ€™t require anything to be committed to your repository.</p>
<p><img src="/images/cake-tutorial/BootstrapperGeneratedFoldersAndFiles.png" alt=""></p>
<h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3:"></a>Step 3:</h2><p>Now we need to do any preparation. In our example, we need to prepare by setting up our build directory and making our solution file path.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> buildDir = Directory(<span class="string">"./src/Cake.XdtTransform/bin"</span>) + Directory(configuration);</span><br><span class="line"><span class="keyword">var</span> solution = <span class="string">"./src/Cake.XdtTransform.sln"</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This is very basic, but you can imagine if you have a more complex setup like for a really complex build, you may have dozens of items that need prepared.</p>
<h2 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4:"></a>Step 4:</h2><p>Now we get to tasks. This is the targets that you will be executing to perform your build. Lots of items will be going on in this step and I will do my best to walk you through all of these.</p>
<h3 id="Cleaning-the-Directory"><a href="#Cleaning-the-Directory" class="headerlink" title="Cleaning the Directory"></a>Cleaning the Directory</h3><p>Always a good idea to clean any directories that you will be writing too.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Clean"</span>)</span><br><span class="line">    .Does(() =&gt;&#123;</span><br><span class="line">        CleanDirectory(buildDir);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Restoring-NuGet-Packages"><a href="#Restoring-NuGet-Packages" class="headerlink" title="Restoring NuGet Packages"></a>Restoring NuGet Packages</h3><p>This task introduces a new concept. If you look at the <em>.IsDependentOn</em> online, you will notice that we pass it the clean task. What this is doing is telling Cake, hey, before <em>Restore-NuGet-Packages</em> executes, the <em>Clean</em> tasks needs to occur first. This is the method that you will use to link your build tasks together to make sure that no matter which task you pass to be executed any dependent tasks are executed first. Finally, we call <em>NuGetRestore</em> which will fetch our NuGet packages. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Restore-NuGet-Packages"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Clean"</span>)</span><br><span class="line">    .Does(() =&gt; &#123;</span><br><span class="line">        NuGetRestore(solution);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Buiding-the-solution"><a href="#Buiding-the-solution" class="headerlink" title="Buiding the solution"></a>Buiding the solution</h3><p>Now that we have clean directories and restored NuGet packages we are ready to perform our build. We will create our build task with a dependency on <em>Restore-NuGet-Packages</em> to ensure that our packages are always restored before executing a build. We are going to use MSBuild to build our project.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Build"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Restore-NuGet-Packages"</span>)</span><br><span class="line">    .Does(() =&gt;&#123;</span><br><span class="line">      <span class="comment">// Use MSBuild</span></span><br><span class="line">      MSBuild(solution, settings =&gt;</span><br><span class="line">        settings.SetConfiguration(configuration));  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Finishing-the-Cake-file"><a href="#Finishing-the-Cake-file" class="headerlink" title="Finishing the Cake file"></a>Finishing the Cake file</h2><p>Now that we have the basics in place, lets finish the basic setup that needs to happen. We need to create a default task that will execute one of the tasks we just defined.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Default"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Build"</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Next we need to actually tell Cake to run the target parameter, which is you remember when we defined our arguments we defaulted to <em>Default</em>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">RunTarget(target);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now we need to execute the Cake file to see if all the work we have done will execute and build our project.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .\build.ps1</span><br></pre></td></tr></table></figure>
<p>You should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">Preparing to run build script...</span><br><span class="line">Running build script...</span><br><span class="line">Analyzing build script...</span><br><span class="line">Processing build script...</span><br><span class="line">Compiling build script...</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Clean</span><br><span class="line">========================================</span><br><span class="line">Executing task: Clean</span><br><span class="line">Cleaning directory C:/Users/cphil/code/Cake.XdtTransform/src/Cake.XdtTransform/bin/Release</span><br><span class="line">Finished executing task: Clean</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Restore-NuGet-Packages</span><br><span class="line">========================================</span><br><span class="line">Executing task: Restore-NuGet-Packages</span><br><span class="line">MSBuild auto-detection: using msbuild version &apos;14.0&apos; from &apos;C:\Program Files (x86)\MSBuild\14.0\bin&apos;.</span><br><span class="line">All packages listed in packages.config are already installed.</span><br><span class="line">Finished executing task: Restore-NuGet-Packages</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Build</span><br><span class="line">========================================</span><br><span class="line">Executing task: Build</span><br><span class="line">Microsoft (R) Build Engine version 14.0.25420.1</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">Build started 7/24/2016 2:32:43 PM.</span><br><span class="line">     1&gt;Project &quot;C:\Users\cphil\code\Cake.XdtTransform\src\Cake.XdtTransform.sln&quot; on node 1 (Build target(s)).</span><br><span class="line">     1&gt;ValidateSolutionConfiguration:</span><br><span class="line">         Building solution configuration &quot;Release|Any CPU&quot;.</span><br><span class="line">     1&gt;Project &quot;C:\Users\cphil\code\Cake.XdtTransform\src\Cake.XdtTransform.sln&quot; (1) is building &quot;C:\Users\cphil\code\C</span><br><span class="line">       ake.XdtTransform\src\Cake.XdtTransform\Cake.XdtTransform.csproj&quot; (3) on node 1 (default targets).</span><br><span class="line">     ......</span><br><span class="line">     2&gt;Done Building Project &quot;C:\Users\cphil\code\Cake.XdtTransform\src\Cake.XdtTransform.Tests\Cake.XdtTransform.Tests</span><br><span class="line">       .csproj&quot; (default targets).</span><br><span class="line">     1&gt;Done Building Project &quot;C:\Users\cphil\code\Cake.XdtTransform\src\Cake.XdtTransform.sln&quot; (Build target(s)).</span><br><span class="line"></span><br><span class="line">Build succeeded.</span><br><span class="line">    0 Warning(s)</span><br><span class="line">    0 Error(s)</span><br><span class="line"></span><br><span class="line">Time Elapsed 00:00:00.38</span><br><span class="line">Finished executing task: Build</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Default</span><br><span class="line">========================================</span><br><span class="line">Executing task: Default</span><br><span class="line">Finished executing task: Default</span><br><span class="line"></span><br><span class="line">Task                          Duration</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Clean                         00:00:00.0091045</span><br><span class="line">Restore-NuGet-Packages        00:00:00.3995194</span><br><span class="line">Build                         00:00:00.4472326</span><br><span class="line">Default                       00:00:00.0098848</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Total:                        00:00:00.8657413</span><br></pre></td></tr></table></figure>
<p>So it looks like we had a successful run of our Cake file. At this point we could just stop, but continue on as now we are getting into the more advanced topics.</p>
<h2 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5:"></a>Step 5:</h2><p>In this step we are going to create a task that will execute our unit tests. In this example we are using <a href="http://fixie.github.io/" target="_blank" rel="external">Fixie</a>, however, most major unit testing frameworks are supported. We will be adding a new concept that this step. We are going to start using the <em>tool</em> directive. The <em>tool</em> directive tells Cake that it needs to download additional tools to perform one of the tasks. The <em>tool</em> directive will place the tool package in the <em>tools</em> directory that the bootstrapper downloads NuGet and Cake too.</p>
<p>At the top of our Cake build file put the following <em>tool</em> directive.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#tool "nuget:?package=Fixie"</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now that we have the Fixie unit test runner being downloaded as part of our Cake file, we need to create our unit test task. In this task we use a pattern to tell Cake to search all directories looking for a bin folder and a configuration folder that matches and return all dlls with the name <em>Tests.dll</em>. Also note that our task is dependent on the build task.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Run-Unit-Tests"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Build"</span>)</span><br><span class="line">    .Does(() =&gt;&#123;</span><br><span class="line">        Fixie(<span class="string">"./src/\*\*/bin/"</span> + configuration + <span class="string">"/*.Tests.dll"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now that we have our test task in place and I want the default behavior to always run the unit tests. So I need to change the default task.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Default"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Run-Unit-Tests"</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now we need to execute our Cake file and make sure nothing has been broken.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .\build.ps1</span><br></pre></td></tr></table></figure>
<p>You should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\cphil\code\Cake.XdtTransform [develop â‰¡ +0 ~1 -0 !]&gt; .\build.ps1</span><br><span class="line">Preparing to run build script...</span><br><span class="line">Running build script...</span><br><span class="line">Analyzing build script...</span><br><span class="line">Processing build script...</span><br><span class="line">Installing tools...</span><br><span class="line">Compiling build script...</span><br><span class="line"></span><br><span class="line">...................</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Run-Unit-Tests</span><br><span class="line">========================================</span><br><span class="line">Executing task: Run-Unit-Tests</span><br><span class="line">------ Testing Assembly Cake.XdtTransform.Tests.dll ------</span><br><span class="line"></span><br><span class="line">6 passed, 0 failed, took 0.33 seconds (Fixie 1.0.2).</span><br><span class="line"></span><br><span class="line">Finished executing task: Run-Unit-Tests</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Default</span><br><span class="line">========================================</span><br><span class="line">Executing task: Default</span><br><span class="line">Finished executing task: Default</span><br><span class="line"></span><br><span class="line">Task                          Duration</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Clean                         00:00:00.0179829</span><br><span class="line">Restore-NuGet-Packages        00:00:00.4070517</span><br><span class="line">Build                         00:00:00.4498772</span><br><span class="line">Run-Unit-Tests                00:00:00.4413167</span><br><span class="line">Default                       00:00:00.0104593</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Total:                        00:00:01.3266878</span><br></pre></td></tr></table></figure>
<p>It looks like our tests all executed successfully and now we celebrate, but wait what good is all this work if we are not sharing it with the world.</p>
<p>Step 6:</p>
<p>If you look in the source directory under the Cake.XdtTransform folder you will notice that there is a nuspec file located in the directory called Cake.XdtTransform.nuspec. Since we have a nuspec file we should go ahead and create a NuGet package while we are here.</p>
<p>Luckily, the creators of Cake have already created the necessary tools to perform the packaging. All we need to do is create a task. We are going to name the task <em>Package</em> and we are going to make it dependent on the <em>Run-Unit-Tests</em> task, because we do not want to package if we fail our tests. We are not going to make this the default task as we want this task to be intentional.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Package"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Run-Unit-Tests"</span>)</span><br><span class="line">    .Does(() =&gt;&#123;</span><br><span class="line">        NuGetPack(<span class="string">"./src/Cake.XdtTransform/Cake.XdtTransform.nuspec"</span>, â€‹<span class="keyword">new</span> NuGetPackSettings());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now to test our handy work, we are going to run the Cake file, but this time we are going to pass a target of <em>Package</em>. What this will do is execute the <em>Package</em> task.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .\build.ps1 -Target Package</span><br></pre></td></tr></table></figure>
<p>You should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\cphil\code\Cake.XdtTransform [develop â‰¡ +0 ~1 -0 !]&gt; .\build.ps1</span><br><span class="line">Preparing to run build script...</span><br><span class="line">Running build script...</span><br><span class="line">Analyzing build script...</span><br><span class="line">Processing build script...</span><br><span class="line">Installing tools...</span><br><span class="line">Compiling build script...</span><br><span class="line"></span><br><span class="line">...................</span><br><span class="line"></span><br><span class="line">========================================</span><br><span class="line">Package</span><br><span class="line">========================================</span><br><span class="line">Executing task: Package</span><br><span class="line">Attempting to build package from &apos;Cake.XdtTransform.temp.nuspec&apos;.</span><br><span class="line">Successfully created package &apos;C:\Users\cphil\code\Cake.XdtTransform\Cake.XdtTransform.0.10.0.0.nupkg&apos;.</span><br><span class="line">Finished executing task: Package</span><br><span class="line"></span><br><span class="line">Task                          Duration</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Clean                         00:00:00.0127528</span><br><span class="line">Restore-NuGet-Packages        00:00:00.4139956</span><br><span class="line">Build                         00:00:00.4605471</span><br><span class="line">Run-Unit-Tests                00:00:00.4670142</span><br><span class="line">Package                       00:00:00.4101675</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Total:                        00:00:01.7644772</span><br></pre></td></tr></table></figure>
<h1 id="The-finish-line"><a href="#The-finish-line" class="headerlink" title="The finish line"></a>The finish line</h1><p>So there you go, a basic walk through using Cake to perform the majority of the tasks that will need to be performed when working on a project. I have purposely left off the publishing of the project to a server or in this case NuGet, as there are more steps involved and those tasks are more about preference at that point. I know that I will probably let my CI server for the project, AppVeyor pick up the NuGet packae as an artifact and publish it. I may revist that in the new future as I learn to integrate Cake with a CI server.</p>
<p>Thanks for reading and hopefully you found this helpful.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Hi, my name is Jamie and I am a &lt;a href=&quot;http://cakebuild.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cake&lt;/a&gt; addin author that doesnâ€™t build m
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
      <category term="Tutorials" scheme="http://www.phillipsj.net/tags/Tutorials/"/>
    
  </entry>
  
  <entry>
    <title>Shockingly Sweet: Electron and Cake</title>
    <link href="http://www.phillipsj.net/2016/07/23/Shockingly-Sweet-Electron-and-Cake/"/>
    <id>http://www.phillipsj.net/2016/07/23/Shockingly-Sweet-Electron-and-Cake/</id>
    <published>2016-07-24T02:48:40.000Z</published>
    <updated>2016-07-27T02:44:41.435Z</updated>
    
    <content type="html"><![CDATA[<p>We have recently started using <a href="http://electron.atom.io/" target="_blank" rel="external">Electron</a> for an application we have been developing. We have enjoyed the experience so much we have decided as a team that all desktop applications going forward will be Electron based. This is great as it keeps the web development skills sharp even when making a desktop application, plus it leverages our knowledge in web technologies and we donâ€™t have to context switch. </p>
<p>To keep the consistency with all our other projects we decided to use Cake to build our Electron applications. We use <a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="external">electron-builder</a> to perform the heavy lifting with a few NPM scripts.  We then execute those NPM scripts using Cake. You can take a look at the complete solution <a href="https://github.com/phillipsj/shockingly-sweet" target="_blank" rel="external">here</a>. Below I will walk you through the Cake file.</p>
<p>So we start off by getting the <a href="https://github.com/philo/cake-npm" target="_blank" rel="external">Cake.Npm</a> addin.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#addin Cake.Npm</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>With the addin for NPM added we have the typical arguments section and as far as the default task, is typically what you see in Cake. We are going to focus on the Electron specific tasks.</p>
<p>Calling an NPM script that configures the environment and performing an NPM install:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Npm-Install"</span>)   </span><br><span class="line">    .Does(() =&gt; &#123;</span><br><span class="line">       Npm.RunScript(<span class="string">"setupEnv"</span>);</span><br><span class="line">       Npm.Install();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Running a clean on the project using an NPM script.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Clean"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Npm-Install"</span>)</span><br><span class="line">    .Does(() =&gt; &#123;</span><br><span class="line">        Npm.RunScript(<span class="string">"clean"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now we have the main part, which is running the dist NPM script that packages the application and builds the executable.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Task(<span class="string">"Build"</span>)</span><br><span class="line">    .IsDependentOn(<span class="string">"Clean"</span>)</span><br><span class="line">    .Does(() =&gt; &#123;</span><br><span class="line">        Npm.RunScript(<span class="string">"dist"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So yes, the majority of this process relies upon NPM scripts, which we could easily just move the calls into the Cake file and out of the package.json.  The main advantage that I am not showing here, is the addins that we use like <a href="https://github.com/RadioSystems/Cake.AzureStorage" target="_blank" rel="external">Cake.AzureStorage</a> to push the packaged application to Azure, or some of the other addins we use that are just easier for us to create that functionality in .NET. </p>
<p>Hope this is helpful.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;We have recently started using &lt;a href=&quot;http://electron.atom.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Electron&lt;/a&gt; for an application we have 
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
      <category term="Electron" scheme="http://www.phillipsj.net/tags/Electron/"/>
    
  </entry>
  
  <entry>
    <title>Learning Fixie and Should</title>
    <link href="http://www.phillipsj.net/2016/07/23/Learning-Fixie-and-Should/"/>
    <id>http://www.phillipsj.net/2016/07/23/Learning-Fixie-and-Should/</id>
    <published>2016-07-23T14:22:51.000Z</published>
    <updated>2016-07-23T14:49:16.311Z</updated>
    
    <content type="html"><![CDATA[<p>To be a good steward of my Cake.XdtTransform project, I decided that I needed to add some unit tests. With such a small project with very little functionality, I took it as an opportunity to learn a new tool. I have looked at the <a href="http://fixie.github.io/" target="_blank" rel="external">Fixie</a> project a few times, but havenâ€™t really given it much thought as I have the most experience with <a href="http://nunit.org/" target="_blank" rel="external">NUnit</a> and <a href="https://xunit.github.io/" target="_blank" rel="external">xUnit</a>. As with any new tool, I wanted to make sure it would work with my intended work flow and of course it does, as it is already in Cake.</p>
<p>To get started all you have to do is use NuGet to install, then you can start writing your tests. The interesting part is that Fixie relies on convention over configuration and doesnâ€™t require all the ceremony of attributes. Just create a class that ends with â€œTestsâ€ in itâ€™s name and the test runner will pick it up. Now, if you are used to a framework that provides an assertion library baked in, that is not Fixie. You will have to pick an assertion library that fits your needs. In the examples for Fixie, <a href="https://github.com/erichexter/Should" target="_blank" rel="external">Should</a> is used, so I decided I would give it a try. Should is a nice library, but you have to think very differently about how to write your test.</p>
<p>Here is a test in xUnit:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> [Fact]</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Should_Error_If_Source_File_Is_Null</span>(<span class="params"></span>)(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// Given</span></span><br><span class="line">     <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;SourceFile = <span class="literal">null</span>&#125;;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// When</span></span><br><span class="line">     <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Then</span></span><br><span class="line">     Assert.IsExceptionWithMessage&lt;ArgumentNullException&gt;(result, <span class="string">"sourceFile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>And here is a test with Fixie:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShouldErrorIfSourceFileIsNull</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Given</span></span><br><span class="line">    <span class="keyword">var</span> fixture = <span class="keyword">new</span> XdtTransformationFixture &#123;SourceFile = <span class="literal">null</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When</span></span><br><span class="line">    <span class="keyword">var</span> result = Record.Exception(() =&gt; fixture.TransformConfig());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then</span></span><br><span class="line">    result.ShouldBeType&lt;ArgumentNullException&gt;().ParamName.ShouldEqual(<span class="string">"sourceFile"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>As you can see they are not that different until you get to the assertion. This was the hard part as it is a different way of thinking. You are not comparing two results you are using the result, then you are asserting what the different properties of the result should be. Once I got my mind wrapped around that concept, it became pretty easy to write tests using Should. There are several other choices for assertions and there is a list in the Fixie documentation.</p>
<p>I really like how Fixie is simple to get started with, uses conventions, and doesnâ€™t provide an assertion library by default. It has made me think just a little differently about choices. Funny how you donâ€™t think you can use a different assertion library with your go to unit testing framework, but you can. So you like Should, I donâ€™t see any reason you couldnâ€™t use it with your favorite unit testing library. </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;To be a good steward of my Cake.XdtTransform project, I decided that I needed to add some unit tests. With such a small project with very
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Integrity Scan</title>
    <link href="http://www.phillipsj.net/2016/07/17/Integrity-Scan/"/>
    <id>http://www.phillipsj.net/2016/07/17/Integrity-Scan/</id>
    <published>2016-07-17T23:40:02.000Z</published>
    <updated>2016-07-19T02:48:30.898Z</updated>
    
    <content type="html"><![CDATA[<p>So I have recently been through a soft skills based training program at my current company. This coupled with the business coach that the company provided has been a tremendous boost to me both professionally and personally. I have grown so much over the last year and it is all finally starting to come together and I am learning to cope with situations that I would never have dreamed I could handle. As part of this training I was provided a list of books that one of th coaches thought would help polish some of my skills. One of those was <a href="https://www.amazon.com/Fierce-Conversations-Achieving-Success-Conversation/dp/0425193373/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1468799492&amp;sr=1-1&amp;keywords=fierce+conversations" target="_blank" rel="external">â€œFierce Conversationsâ€</a> by Susan Scott. I am not very far into the book and I have already found it very inspirational and as far as I am concerned a must read by everyone. The book has some hard hitting stories of issues within companies that result from the companies values not aligning with how they are acting. The same is also applied to you personally, if you are acting in a way counter to your values then you have an integrity issue and you need to perform an â€œintegrity scanâ€.  There is also a really interesting section on <a href="https://en.wikipedia.org/wiki/Psychoneuroimmunology" target="_blank" rel="external">Psychoneuroimmunology</a>, which is something I am going to need to read more about, but the basic introduction is very interesting. </p>
<p>With all of this said, I just wanted to blog about this as a way to get this written down. This is going to serve a purpose for me and I hope that you find these items interesting too. So a few interesting quotes have appeared in a matter of about ten pages that have simply sparked something inside me. I am going to share them here as I found this are very shocking to the system even though I feel that we all inherently know this information, but sometimes you just need it plainly stated.</p>
<p>The quote below is in reference to mission statements, but I find that it can be applied to a lot more than mission statements.</p>
<blockquote><p>You cannot impose those beliefs and values on people by twisting and banging and rewarding and sanctioning and inspiring and motivating and hanging your imposition on the wall, no matter how noble a statement you have conceived, because if you do, you become a propagandist and you spend your corporate lifeâ€™s energy attempting to push, pull, and persuade rather than get on with the business of your business, whatever it may be.</p>
<footer><strong>Susan Scott</strong><cite>Fierce Conversations</cite></footer></blockquote>
<p>Isnâ€™t this statement so true? Sometimes people spend so much of their energy trying to get people to think like they do than just focusing on their business. I find myself doing this very thing. As a developer and technologist, I find that at times I am trying to push my own propaganda than getting on with business. Maybe that is why I really like Dan Northâ€™s stuff, right, it is all about adding business value and frankly, most of the crap we talk about in meetings doesnâ€™t really add much value. I can only imagine how effective companies would be if we spent more time on doing the business of our business, than trying to push strategies, agendas, etc. </p>
<p>Then there is this quote.</p>
<blockquote><p>As a leader, you get what you tolerate.</p>
<footer><strong>Susan Scott</strong><cite>Fierce Conversations</cite></footer></blockquote>
<p>Wow, what a gut punch. This just rung my bell and cut deep. As a leader in your organization this has to hit home, it does it for me. I feel that I have a high level of integrity and I am usually quick to let people know if I donâ€™t like something, but I am not always there after the statement, I let it float there. So if you get what you tolerate, then how do you go about letting people know what is intolerable? No clue, but I think this needs a little caution, right. So know I have to pull out a Thomas Jefferson quote.</p>
<blockquote><p>In matters of style, swim with the current; in matters of principle, stand like a rock.</p>
<footer><strong>Thomas Jefferson</strong></footer></blockquote>
<p>I think we need to make sure that it is truly a matter of principle before we become intolerant. We have to respect that people work and solve problems differently and we need that diversity to be a successful business.  However, in matters of principle, those core values, beliefs, etc. that are fundamental to who you are personally and as a company, you cannot tolerate the compromising of those. I find myself very stressed and in constant turmoil because I have not stayed true to the fundamental of who I am.  I am not behaving in a manner that is true to my core values.  I am not far from them, but I am not as aligned as I have been in the past and I can tell. As a company, I think this can be seen and felt based on moral, turnover, etc. How do you address a team member, group, or business unit that is not behaving consistent to company values? How do you continue to be true to the values and your values if they are not aligned?</p>
<p>So I am going to work on getting real with myself and work through these issues above. I have lots of personal items to work through in addition. So the book proceeds after the information above to tell a story from Studs Terkelâ€™s book <a href="https://www.amazon.com/Working-People-Talk-About-What/dp/1565843428" target="_blank" rel="external">â€œWorkingâ€</a>. This statement I find very true with pockets of people through out my entire life.  To frame the quote below it is about a young woman you landed her first job and wanted to give it her best.</p>
<blockquote><p>The problem was, her coworkers made it clear in subtle and not so subtle ways that if she brought everything she had to the task, she would wreck the curve for everyone else.</p>
<footer><strong>Studs Terkel</strong><cite>Working</cite></footer></blockquote>
<p>Hopefully that hit home for many people, it did me. I am not very tolerant when people are not bringing their best to their job. I donâ€™t expect it all the time, but I expect it the majority of the time. People can have off times, but if you are not bringing your â€œeverythingâ€ to what you are doing then why even do it. If you donâ€™t feel it is worth your best effort, then find something better to do with your time.  I expect technical excellence from my team and I expect them to bring their best. What I have found is people like it when others believe in them and want them to do their best. I will take someone who brings their best and is willing to work than someone with â€œnatural talentâ€(I know about Malcom Gladwell and I agree with him). Then next part of the book came this statement.</p>
<blockquote><p>Within a month, I had absented my spirit from my work.</p>
<footer><strong>Studs Terkel</strong><cite>Working</cite></footer></blockquote>
<p>That makes my cringe. I donâ€™t want people to feel absented in their work. I want people to feel excited about coming to work. People that are excited are going to give it their all and that is what you need and that is what they need. It is a win-win-win for everyone involved. I get the distinctive feeling with some groups of people that they have â€œabsented their spiritâ€, gave up on their values, and now their psychoneuroimmunology has been compromised.  With it compromised for a few we lose out on <a href="https://en.wikipedia.org/wiki/Herd_immunity" target="_blank" rel="external">herd immunity</a> at work. With our immunity now compromised as a group we can start losing others that are less resilient to it. As example provided in the book was Enron, I would have to agree, it is how companies and individuals go from doing what is true to themselves to doing things they would never believe. Now just when you think I cannot ramble any longer, I assure you this book keeps throwing punches like Muhammend Ali. Here is another hard hitting quote.</p>
<blockquote><p>If you want to see someone in real pain, watch someone who knows who he is and defaults on it on a regular basis.</p>
<footer><strong>Pam Murray</strong></footer></blockquote>
<p>This calls me to action and is the main driver for even making this post. I feel at times I am in pain, do to the decisions that I am left to make. I feel that none of my decisions are desirable, but then I realize that actually I have more freedom and donâ€™t have to make a decision based on the options that I am given, I can always choose an option that is not presented. This is a false choice, logical fallacy, grifting, manipulation, etc. You always have the option to choose an option that was presented. People use this to manipulate you to the outcome that they desire and  try to steal your joy in your work.</p>
<blockquote><p>However, if your job is no longer appropriate or sufficient for you and the situation cannot be remedied unless you were to become a different human being entirely, itâ€™s time to leave.</p>
<footer><strong>Susan Scott</strong><cite>Fierce Conversations</cite></footer></blockquote>
<p>This is a powerful statement and one that resonates. After all of this, I am going to let the previous one and this last one simmer on my mind.</p>
<blockquote><p>I am successful to the degree that who I am and what I live are in alignment.</p>
<footer><strong>Susan Scott</strong><cite>Fierce Conversations</cite></footer></blockquote>
<p>If you made it to the end, I really appreciate the time that you took to read what is on my mind. I hope to get back to the regularly scheduled program, but it may take a few more of these to get it all out.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So I have recently been through a soft skills based training program at my current company. This coupled with the business coach that the
    
    </summary>
    
    
      <category term="Books" scheme="http://www.phillipsj.net/tags/Books/"/>
    
      <category term="Soft Skills" scheme="http://www.phillipsj.net/tags/Soft-Skills/"/>
    
  </entry>
  
  <entry>
    <title>BunsenLabs, awesome continuation of a legacy</title>
    <link href="http://www.phillipsj.net/2016/06/25/BunsenLabs-awesome-continuation-of-a-legacy/"/>
    <id>http://www.phillipsj.net/2016/06/25/BunsenLabs-awesome-continuation-of-a-legacy/</id>
    <published>2016-06-26T01:50:23.000Z</published>
    <updated>2016-06-26T02:00:27.033Z</updated>
    
    <content type="html"><![CDATA[<p>So of all linux distrubutions that exist, by far my favorite has probably been CrunchBang linux. It is a distribution built on Debian with a wonderful window manager. CrunchBang used OpenBox and created a whole distro that was built around its speed an simplicity. However, as all good things it came to and end. Wanting to replace my slow Ubuntu VM, I went back to the CrunchBang website to see if anyone has picked up the project. No one has, but there has been a few continuation projects that popped up under a new name. Out of all of them, it is <a href="https://www.bunsenlabs.org" target="_blank" rel="external">BunsenLabs</a> is my favorite. The installation is a breeze and configuration is smooth as butter.</p>
<p>If you are looking for a lightweight linux distro for running as a VM or to run on older hardware, then give BunsenLabs a consideration.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So of all linux distrubutions that exist, by far my favorite has probably been CrunchBang linux. It is a distribution built on Debian wit
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Linux" scheme="http://www.phillipsj.net/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>XML Docs for Cake Addins</title>
    <link href="http://www.phillipsj.net/2016/06/18/XML-Docs-for-Cake-Addins/"/>
    <id>http://www.phillipsj.net/2016/06/18/XML-Docs-for-Cake-Addins/</id>
    <published>2016-06-18T13:59:28.000Z</published>
    <updated>2016-06-18T14:02:01.326Z</updated>
    
    <content type="html"><![CDATA[<p>As most that know me or have been following this blog, I absolutely love <a href="http://cakebuild.net/" target="_blank" rel="external">Cake</a> build tools. To be a better steward in the community of the addins that<br>I created and another that I help maintain, I updated the XML documentation and submitted a pull reques to finally have these added to the Addins section of the Cake website.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;As most that know me or have been following this blog, I absolutely love &lt;a href=&quot;http://cakebuild.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;C
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Fun with Electron</title>
    <link href="http://www.phillipsj.net/2016/05/13/Fun-with-Electron/"/>
    <id>http://www.phillipsj.net/2016/05/13/Fun-with-Electron/</id>
    <published>2016-05-14T00:00:00.000Z</published>
    <updated>2016-05-31T00:12:01.649Z</updated>
    
    <content type="html"><![CDATA[<p>So I have had the privilege to get to learn a little about <a href="http://electron.atom.io/" target="_blank" rel="external">Electron</a>. My team<br>inherited an app that was built using <a href="http://appjs.com/" target="_blank" rel="external">AppJS</a>. Since that project is deprecated,<br>we needed to move it to a new platform. I started looking around and decided to<br>give Electron a try since I have been using <a href="https://atom.io/" target="_blank" rel="external">Atom</a> and <a href="https://code.visualstudio.com/" target="_blank" rel="external">VSCode</a>. Another great<br>thing about Electron is that we can get to keep our deployment consistent since<br>it also uses <a href="https://github.com/Squirrel/Squirrel.Windows" target="_blank" rel="external">Squirrel.Windows</a> like we have started using for our other desktop<br>apps. An added bonus is we can use <a href="http://facebook.github.io/react/" target="_blank" rel="external">React</a> also.</p>
<p>My only recommendation is that it helps to have the following items installed on<br>a Windows System as it will make building any native node modules easier.</p>
<ul>
<li><a href="https://www.python.org/downloads/release/python-2711/" target="_blank" rel="external">Python 2.7.x</a> matching the bitness of your Node.</li>
<li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266" target="_blank" rel="external">Visual C++ Compiler for Python 2.7</a></li>
<li><a href="https://www.visualstudio.com/vs-2015-product-editions" target="_blank" rel="external">Visual C++ for Visual Studio 2015</a></li>
<li><a href="https://developer.microsoft.com/en-us/windows/downloads/windows-8-1-sdk" target="_blank" rel="external">Windows 8.1 SDK</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So I have had the privilege to get to learn a little about &lt;a href=&quot;http://electron.atom.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Electron&lt;/a&gt;
    
    </summary>
    
    
      <category term="Electron" scheme="http://www.phillipsj.net/tags/Electron/"/>
    
      <category term="OSS" scheme="http://www.phillipsj.net/tags/OSS/"/>
    
      <category term="Node" scheme="http://www.phillipsj.net/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript: The Orchard Way</title>
    <link href="http://www.phillipsj.net/2015/12/18/JavaScript-The-Orchard-Way/"/>
    <id>http://www.phillipsj.net/2015/12/18/JavaScript-The-Orchard-Way/</id>
    <published>2015-12-19T00:00:00.000Z</published>
    <updated>2016-05-31T00:23:39.728Z</updated>
    
    <content type="html"><![CDATA[<p>So I have been attending the <a href="http://www.orchardproject.net/discussions" target="_blank" rel="external">Orchard community</a> meetings since we started to<br>use Orchard for our current project. Orchard is a great system that is very<br>moduler, with hooks and interfaces that can be overridden in a very easy way, once<br>you learn it. So this past week, the discussion turned to what JavaScript framework<br>should be used for Orchard core javascript needs. We all know that the conversation<br>quickly went to <a href="https://angularjs.org/" target="_blank" rel="external">Angular</a>.  There were several other frameworks discussed, but the<br>top two were clearly Angular and <a href="http://facebook.github.io/react/" target="_blank" rel="external">ReactJS</a>. Then an interesting question surfaced<br>from <a href="http://weblogs.asp.net/bleroy" target="_blank" rel="external">Bertrand</a>, it was â€œWhich one is the Orchard way?â€. So I know that the Orchard<br>team has a very defined culture and I have heard that statement several times in the<br>past, but it got me wondering if a blog post or any formal statement of â€œThe Orchard Wayâ€<br>has been created. With that I stumbled on to a <a href="https://weblogs.asp.net/bleroy/the-orchard-way" target="_blank" rel="external">post</a> by Bertrand that has the answer.</p>
<p>So with that answered, the next question is which framework is the closest to that<br>philosophy. After binging for around the internet to gather a few more opinions<br>to see if I felt differently I do not. ReactJS provies a very easy and clear<br>mental model. This is a very basic statement if what is happening to illustrate the point.<br>You create components that are encapsulated, reusable, and have a single responsibility.<br>Data is pushed down from each parent and the child component that needs some data recieves it<br>from the parent. Does this sound familiar, it sounds similar to Bertrandâ€™s example,<br>where the car builder has assembelers that only fulfill one specific component and<br>they donâ€™t worry about the other components. Now I am going to stretch the example<br>a litte, because I am sure if there is something need by the assemblers then a<br>call is made and more information is pushed down from a higher level, sounds a<br>lot like the one-way data flow provided forced by React. Which leads me to the qoute<br>found in <a href="https://github.com/kmcclosk/reactjs-rxjs-example" target="_blank" rel="external">this</a> readme, â€œIts (React) sort of like the Actor Modelâ€, which I agree it<br>is kind of like that. So if you think about how each component is an actor that can<br>contain actors and those components send messages with actions back up, etc.</p>
<p>So to end, I do this that React is more like Elonâ€™s factory than Gregâ€™s, so that<br>is why I feel Orchard should choose React.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So I have been attending the &lt;a href=&quot;http://www.orchardproject.net/discussions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orchard community&lt;/a&gt; mee
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Orchard" scheme="http://www.phillipsj.net/tags/Orchard/"/>
    
      <category term="ReactJS" scheme="http://www.phillipsj.net/tags/ReactJS/"/>
    
  </entry>
  
  <entry>
    <title>Cake.Squirrel</title>
    <link href="http://www.phillipsj.net/2015/12/04/Cake-Squirrel/"/>
    <id>http://www.phillipsj.net/2015/12/04/Cake-Squirrel/</id>
    <published>2015-12-05T00:00:00.000Z</published>
    <updated>2016-07-31T18:12:35.914Z</updated>
    
    <content type="html"><![CDATA[<p>Just published a new package called <a href="https://www.nuget.org/packages/Cake.Squirrel/" target="_blank" rel="external">Cake.Squirrel</a>. It integrates <a href="https://github.com/Squirrel/Squirrel.Windows" target="_blank" rel="external">Squirrel.Windows</a> into the Cake pipeline so you can now create your Squirrel package using Cake.</p>
<p>Still a little work left to do, I would like to add a fluent API, so keep checking back.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Just published a new package called &lt;a href=&quot;https://www.nuget.org/packages/Cake.Squirrel/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cake.Squirrel&lt;
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>I like surprises, especially when Cake is involved!</title>
    <link href="http://www.phillipsj.net/2015/11/30/I-like-surprises-especially-when-Cake-is-involved/"/>
    <id>http://www.phillipsj.net/2015/11/30/I-like-surprises-especially-when-Cake-is-involved/</id>
    <published>2015-12-01T00:00:00.000Z</published>
    <updated>2016-05-31T00:23:07.303Z</updated>
    
    <content type="html"><![CDATA[<p>So I was working today to consume a Cake addin that isnâ€™t fully baked. It is<br>an addin that we needed. So I cloned the repo and pushed a copy of the package<br>to a <a href="https://www.myget.org" target="_blank" rel="external">MyGet.org</a> to consume as part of our build. I added a custom NuGet.config<br>file to my Cake tools directory, but Cake would not install the addin. So I just<br>added it to the packages.config, still no dice.  I had to use the older syntax:</p>
<script src="//gist.github.com/556e127e16ed712dbf0b.js?file=OldSyntax.cs"></script>
<p>I wasnâ€™t satisfied with this solution, so I jumped on the Cake Gitter, who doesnâ€™t<br>lover Gitter, and starting asking some questions. I was soon digging into the<br>source and discovered that as part of parsing the addin directive if you put the<br>source after the package name it woud use it. So now I could use the #addin syntax<br>like so:</p>
<script src="//gist.github.com/9f6f8cac2a1bd05f0e9a.js?file=syntax.cs"></script>
<p>So all you have to due is specify a source that can be consumed by NuGet.exe and<br>you can use the #addin syntax.</p>
<p>Such a pleasant surprise, Cake doesnâ€™t dissapoint.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So I was working today to consume a Cake addin that isnâ€™t fully baked. It is&lt;br&gt;an addin that we needed. So I cloned the repo and pushed 
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Web Compiler with a side of Cake</title>
    <link href="http://www.phillipsj.net/2015/11/25/Web-Compiler-with-a-side-of-Cake/"/>
    <id>http://www.phillipsj.net/2015/11/25/Web-Compiler-with-a-side-of-Cake/</id>
    <published>2015-11-26T00:00:00.000Z</published>
    <updated>2016-05-31T00:29:28.729Z</updated>
    
    <content type="html"><![CDATA[<p>My team has been using <a href="http://facebook.github.io/react/" target="_blank" rel="external">React</a> to create any front-end components that need<br>to be interactive. So far it has been a pleasant experience. We started using<br>JSX for our HTML. However, now that we are nearing a production release we wanted<br>to precompile the JSX. We had intially planned to use the <a href="http://reactjs.net/" target="_blank" rel="external">React.NET</a> project, but<br>the JSX support has been dropped in support of using <a href="https://babeljs.io/" target="_blank" rel="external">Babel</a>. Babelâ€™s documentation<br>isnâ€™t the best, so in looking for alternatives before diving in to Babel, I stumbled<br>across <a href="https://github.com/madskristensen/WebCompiler" target="_blank" rel="external">Web Compiler</a> by Mads Kristensen. It just so happens that there is a<br>Visual Studio Extension for it and it will compile LESS, SASS, JSX, and CoffeeScript.<br>Since we are planning to use SASS in the future this appeared to be a great option. The<br>extension makes it easy to use as part of the IDE. There is also a nuget package for it<br>that makes it easy to use with MSBUILD. Now that all of our needs are covered it is<br>time to see if we can get it to work with Cake.</p>
<p>Configuring Web Compiler for use with Cake was extremely easy. Here are the steps<br>needed to have Web Compiler working as part of your Cake builds.</p>
<ol>
<li><p>Edit your packages.config for Cake, you also need Cake.MSBuildTask.</p>
<script src="//gist.github.com/d5d236d048341b4c37e0.js?file=packages.config"></script>
</li>
<li><p>Now add the Web Compiler as an addin in your build.cake file.</p>
<script src="//gist.github.com/5b6e22c7eddccbd9c90d.js?file=Build.cale"></script>
</li>
<li><p>Now create your JSX compile tasks, now use the GetFiles to find all compilerconfig.json files.</p>
<script src="//gist.github.com/75848d11d8d4a4ab091f.js?file=Build.cs"></script>
</li>
</ol>
<p>It is that easy. I may, in the future, remove the need for the MSBuildTask runner.</p>
<p>Hope someone finds this of value.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;My team has been using &lt;a href=&quot;http://facebook.github.io/react/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;React&lt;/a&gt; to create any front-end compon
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Cake.XdtTransform</title>
    <link href="http://www.phillipsj.net/2015/10/21/Cake-XdtTransform/"/>
    <id>http://www.phillipsj.net/2015/10/21/Cake-XdtTransform/</id>
    <published>2015-10-22T00:00:00.000Z</published>
    <updated>2016-07-31T18:12:20.746Z</updated>
    
    <content type="html"><![CDATA[<p>As part of moving our Orchard build over to Cake, I was trying to find a good way to do the config transfomrs.  Cake offers a pretty good XML transform methods, but I wanted a solution that used the XDT transform. A little quick googling and I stumbled across this Github <a href="https://github.com/cake-build/cake/issues/321" target="_blank" rel="external">issue</a>, so with this post I created an addin that adds this functionality. Not realy a big deal, I didnâ€™t think it was necessary to pull that into the core as it adds an extra dependency that is probably not really needed, but it is a nice to have. You can find it up on Nuget also.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;As part of moving our Orchard build over to Cake, I was trying to find a good way to do the config transfomrs.  Cake offers a pretty good
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
  </entry>
  
  <entry>
    <title>Builds are better with Cake</title>
    <link href="http://www.phillipsj.net/2015/10/18/Builds-are-better-with-Cake/"/>
    <id>http://www.phillipsj.net/2015/10/18/Builds-are-better-with-Cake/</id>
    <published>2015-10-19T00:00:00.000Z</published>
    <updated>2016-05-31T00:17:38.750Z</updated>
    
    <content type="html"><![CDATA[<p>As most of you know, my team has been using Orchard to build our next application.<br>While we have found the majority of what Orchard has to offer great, there<br>has been trouble with the build for Orchard. We decided it was time to create a<br>different way to build Orchard that was easier for junior devs to understand and<br>easier for us to consume.</p>
<p>We narrowed it down to <a href="https://github.com/psake/psake" target="_blank" rel="external">Psake</a>, <a href="http://fsharp.github.io/FAKE/" target="_blank" rel="external">Fake</a>, or <a href="http://cakebuild.net/" target="_blank" rel="external">Cake</a>, as these really donâ€™t require<br>anything special that isnâ€™t already on our build servers. I have used tools like<br><a href="http://albacorebuild.net/" target="_blank" rel="external">Albacore</a> in the past, but the extra dependency on Ruby was the deal breaker.</p>
<p>I have used all of these in the past, except for Cake. It is one of the newer<br>build systems on the scene and it just so happens to use C# for its syntax. I<br>have been happy with all, but considering we all primarily work in C#, it just<br>seemed like Cake would be the best fit.</p>
<p>After having worked with Cake for the last two weeks converting the Orchard build<br>from MSBuild file to Cake, I can say that Cake is now easily my favorite build tool<br>and I cannot forsee wanting to use much of anything else. The community has been<br>great and helpful, most of the important tooling has already been created, the<br>only thing that I have had an issue with is changing my way of thinking. The shift<br>from MSBuild to a build tool like Cake, sometimes throws your mind for a loop.</p>
<p>Cake supports of using MSBuild tasks, extra file helpers, Slack integration, etc.<br>all come in the form of an Addin.  Cake is easily extending using their Addin<br>structure, just add a little C# to a project, and Cake can now use that new feature.</p>
<p>I have easily converted customized MSBuild tasks that the Orchard project has created<br>into a Cake Addin called <a href="https://www.nuget.org/packages/Cake.Orchard/" target="_blank" rel="external">Cake.Orchard</a> and it is found on Nuget. I have almost<br>completed the conversation of the Orchard build and will be sharing that in the<br>near future.</p>
<p>Stay tuned if you are interested in adding Cake to your projects.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;As most of you know, my team has been using Orchard to build our next application.&lt;br&gt;While we have found the majority of what Orchard ha
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Cake" scheme="http://www.phillipsj.net/tags/Cake/"/>
    
      <category term="Orchard" scheme="http://www.phillipsj.net/tags/Orchard/"/>
    
  </entry>
  
  <entry>
    <title>Orchard and Azure AD Woes!</title>
    <link href="http://www.phillipsj.net/2015/10/08/Orchard-and-Azure-AD-Woes/"/>
    <id>http://www.phillipsj.net/2015/10/08/Orchard-and-Azure-AD-Woes/</id>
    <published>2015-10-09T00:00:00.000Z</published>
    <updated>2016-05-31T00:26:01.439Z</updated>
    
    <content type="html"><![CDATA[<p>So my team and I have been using Orchard CMS to build the next version of our<br>product. Since we have been using Azure AD for authentication for our applicaions<br>it only made sense to wire Orchard and Azure AD together. The typical way that<br>it is suggested to be done is to Microsoft.Owin.Security.OpenIdConnect middleware.</p>
<p>So we wired this up for Orchard, which was not a straight forward feat given the<br>sparse documentation around OWIN integration. This all worked great locally and<br>on our dev server. We decided to finally push a versiont to Azure to work through<br>our <a href="http://www.stickyminds.com/article/hudsons-bay-start" target="_blank" rel="external">Hudson Bay Start</a>, it would be awful to be close to a deadline and find<br>any suprises.</p>
<p>Well, I was hopeful as I have deployed stock Orchard to Azure several times getting<br>a feel for how it is going to work. The calamity struck, we were ramping up to<br>have some folks from another part of our business assist with creating content,<br>however, I enabled our custom modules and click the signin link and BAM! I<br>was greated with the following error:</p>
<p><strong>The data protection operation was unsuccessful. This may have been caused by not<br>having the user profile loaded for the current threadâ€™s user context, which may<br>be the case when the thread is impersonating.</strong></p>
<script src="//gist.github.com/ffa9fbdafad35f46aaf8.js?file=DataProtectionError.txt"></script>
<p>I quickly started googling and found several suggestions. I tried several different<br>approaches, until I pulled out <a href="https://www.jetbrains.com/decompiler/" target="_blank" rel="external">dotPeek</a> and dug a little through<br><em>Microsoft.Owin.Security</em> and noticed that I needed a different IDataProtectionProvider<br>that doesnâ€™t use DPAPI. I finally got to a <a href="http://stackoverflow.com/questions/23455579/generating-reset-password-token-does-not-work-in-azure-website" target="_blank" rel="external">this</a> on StackOverflow.  The suggestion<br>there was to implement the following:</p>
<script src="//gist.github.com/aa374e21ab5bc9b0ea54.js?file=MachineKeyDataProtector.cs"></script>
<p>Now that I had this implementation, I tried several of the other posts on StackOverflow<br>trying to use Autofac to inject the dependency in, however it was working.</p>
<p>Again, I turned to dotPeek and was taking a look at what was going on with this<br>method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.GetDataProtectionProvider()</span><br></pre></td></tr></table></figure>
<p>While looking at the method, I noticed this other extension method.:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.SetDataProtectionProvider(IDataProtectionProvider provider)</span><br></pre></td></tr></table></figure>
<p>So I added the following to my OwinMiddleware class in my Orchard Module<br>and <strong>IT WORKED!</strong></p>
<script src="//gist.github.com/b4b6ba3367b48bb37cc6.js?file=OwinMiddlware.cs"></script>
<p>This has been a two day issue that we have beent trying to determine what the cause.<br>I will be able to sleep soundly tonight.</p>
<p>Hope someone else finds this helpful.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;So my team and I have been using Orchard CMS to build the next version of our&lt;br&gt;product. Since we have been using Azure AD for authentic
    
    </summary>
    
    
      <category term="Open Source" scheme="http://www.phillipsj.net/tags/Open-Source/"/>
    
      <category term="Orchard" scheme="http://www.phillipsj.net/tags/Orchard/"/>
    
      <category term="Azure" scheme="http://www.phillipsj.net/tags/Azure/"/>
    
      <category term="Owin" scheme="http://www.phillipsj.net/tags/Owin/"/>
    
  </entry>
  
</feed>
